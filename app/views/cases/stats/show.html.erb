<% content_for :title do %>
  <%= I18n.t('cases.stats.show.case_stats') %> â€” <%= @case.short_title %>
<% end %>

<div class="window admin">
  <div class="admin-card admin-card--wide pt-card pt-elevation-2">
    <%= link_to case_path(@case) do %>
      <div class="case-cover-card-top" style="background-image: url(<%= @case.cover_url %>)">
        <span class="admin__table__slug"><%= @case.short_title %></span>
      </div>
    <% end %>

    <main id="stats-main">
      <h1 class="admin__title"><%= t('.case_stats') %></h1>

      <div
        data-controller="case-stats"
        data-url="<%= case_stats_path(@case) %>"
        data-published_at="<%= @case.published_at&.to_date %>">
        <input type="hidden" id="stats-from" data-target="case-stats.from" aria-hidden="true" />
        <input type="hidden" id="stats-to" data-target="case-stats.to" aria-hidden="true" />

        <section class="c-stats-section-overview" aria-labelledby="stats-overview-heading">
          <h2 id="stats-overview-heading" class="c-stats-information__heading"><%= t('.overview') %></h2>
          <div class="c-stats-information-container">
            <div class="c-stats-overview-layout">
              <div class="c-stats-information pt-card pt-elevation-1">
                <h3 class="c-stats-information__card-heading"><%= t('.overview_stats') %></h3>
                <div id="stats-information" role="region" aria-label="<%= t('.overview_stats') %>"></div>
              </div>
              <aside class="c-stats-tips pt-callout pt-icon-info-sign" aria-labelledby="stats-about-visitors-heading">
                <h3 id="stats-about-visitors-heading" class="pt-callout-title"><%= t('.about_visitors') %></h3>
                <div class="pt-callout-content">
                  <p>
                    <%= I18n.t('cases.stats.show.tips_description') %>
                  </p>
                </div>
              </aside>
            </div>
          </div>
        </section>

        <section class="c-stats-section-filter" aria-labelledby="stats-filter-heading">
          <h2 id="stats-filter-heading" class="c-stats-filter-card__heading"><%= t('.filter_by_date') %></h2>
          <div class="c-stats-layout">
            <div class="c-stats-picker pt-card pt-elevation-1" role="group" aria-label="<%= t('.filter_by_date') %>">
              <div id="stats-range-picker"></div>
            </div>
            <div class="c-stats-summary pt-card pt-elevation-1">
              <div id="stats-summary" role="region" aria-live="polite"></div>
            </div>
          </div>
        </section>

        <section class="c-stats-map-table-card pt-card pt-elevation-1" aria-labelledby="stats-map-table-heading">
          <div class="c-stats-map-table__header">
            <h3 id="stats-map-table-heading" class="c-stats-map-table__heading"><%= I18n.t('cases.stats.show.table_title') %></h3>
            <span id="stats-map-table-date-range" class="c-stats-map-table__date-range"></span>
          </div>
          <div class="c-stats-map-container">
            <div id="stats-map" class="c-stats-map" role="region" aria-label="<%= I18n.t('cases.stats.show.map_legend_title') %>"></div>
          </div>
          <div class="c-stats-table-export-layout">
            <div class="c-stats-export-button-container">
              <button type="button" class="pt-button pt-intent-primary pt-icon-export" id="stats-table-export-btn">
                <%= I18n.t('cases.stats.show.table_export_csv') %>
              </button>
            </div>
            <div id="stats-table" class="c-stats-table-container" role="region" aria-label="<%= I18n.t('cases.stats.show.table_title') %>"></div>
          </div>
        </section>
      </div>
    </main>
  </div>
</div>