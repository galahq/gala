<%- headers = [
  I18n.t('cases.stats.csv.country'),
  I18n.t('cases.stats.csv.unique_visitors'),
  I18n.t('cases.stats.csv.first_visit'),
  I18n.t('cases.stats.csv.last_visit')
] -%>
<%= raw CSV.generate_line(headers) -%>
<%- date_format = '%b %d, %Y' -%>
<% @csv_rows.each do |row| -%>
<%= raw CSV.generate_line([
  row[:name],
  row[:unique_visits].to_i,
  row[:first_event]&.strftime(date_format),
  row[:last_event]&.strftime(date_format)
]) -%>
<% end -%>
<%= raw CSV.generate_line([
  I18n.t('cases.stats.csv.total'),
  @csv_rows.sum { |r| r[:unique_visits].to_i },
  nil,
  nil
]) -%>
